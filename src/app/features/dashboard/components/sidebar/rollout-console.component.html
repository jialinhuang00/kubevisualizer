@if (deploymentName) {
<div class="mt-3 ml-2 rollout-console">
  <!-- Rollout Console Header -->
  <div class="accordion-header flex items-center justify-between mb-2 cursor-pointer p-2 rounded"
    [class.expanded]="isExpanded" style="background: rgba(0, 255, 255, 0.1);" (click)="onToggleExpanded()">
    <h4 class="text-sm font-medium flex items-center" style="color: var(--accent-cyan)">
      Rollout Console
      <span class="text-xs ml-2 opacity-75">({{ deploymentName }})</span>
    </h4>
    <span class="accordion-arrow text-sm" style="color: var(--text-secondary);">
      â–¶
    </span>
  </div>

  <div class="accordion-content" [class.expanded]="isExpanded">
    <div class="space-y-3 border-l-2 py-1 pl-2" style="border-color: var(--accent-cyan)">

      <!-- Version Player Controls -->
      <div class="player-controls bg-opacity-20 p-3 rounded-lg"
        style="background: rgba(0, 255, 255, 0.05); border: 1px solid rgba(0, 255, 255, 0.3);">
        <div class="flex items-center justify-between mb-2">
          <div class="text-xs font-medium glow-text" style="color: var(--accent-cyan);">
            Version Player
            @if (deploymentStatus && buttonStates) {
            <span class="ml-2 text-xs opacity-75" style="color: var(--text-secondary);">
              {{ getStatusText() }}
            </span>
            }
          </div>
          <!-- macOS Style Status Lights -->
          <div class="flex items-center space-x-1">
            <div class="w-3 h-3 rounded-full border border-gray-600 status-light"
              [style.background-color]="getStatusColor('red')" title="Failed/Error/No Ready Replicas">
            </div>
            <div class="w-3 h-3 rounded-full border border-gray-600 status-light"
              [style.background-color]="getStatusColor('yellow')" title="Paused/Rolling Out (Active)">
            </div>
            <div class="w-3 h-3 rounded-full border border-gray-600 status-light"
              [style.background-color]="getStatusColor('green')" title="Stable/Rolling Out (Target)/Ready">
            </div>
          </div>
        </div>

        <div class="flex items-center justify-center space-x-1 flex-wrap">
          <!-- Rollback to Previous -->
          <button class="player-btn rollback-btn p-2 rounded hover:bg-opacity-75 transition-all duration-200"
            [title]="getRollbackTooltip()" [disabled]="!buttonStates?.rollbackEnabled"
            [class.disabled]="!buttonStates?.rollbackEnabled" (click)="onRollbackToPrevious()">
            <mat-icon>skip_previous</mat-icon>
          </button>

          <!-- Pause Rollout -->
          <button class="player-btn pause-btn p-2 rounded hover:bg-opacity-75 transition-all duration-200"
            [title]="getPauseTooltip()" [disabled]="!buttonStates?.pauseEnabled"
            [class.disabled]="!buttonStates?.pauseEnabled" (click)="onPauseRollout()">
            <mat-icon>pause</mat-icon>
          </button>

          <!-- Resume Rollout -->
          <button class="player-btn play-btn p-2 rounded hover:bg-opacity-75 transition-all duration-200"
            [title]="getResumeTooltip()" [disabled]="!buttonStates?.resumeEnabled"
            [class.disabled]="!buttonStates?.resumeEnabled" (click)="onResumeRollout()">
            <mat-icon>play_arrow</mat-icon>
          </button>

          <!-- Restart Deployment -->
          <button class="player-btn restart-btn p-2 rounded hover:bg-opacity-75 transition-all duration-200"
            [title]="getRestartTooltip()" [disabled]="!buttonStates?.restartEnabled"
            [class.disabled]="!buttonStates?.restartEnabled" (click)="onRestartDeployment()">
            <mat-icon>refresh</mat-icon>
          </button>

          <!-- Version Upgrades -->
          <div class="version-separator"></div>
          <button class="player-btn upgrade-btn px-3 py-2 rounded hover:bg-opacity-75 transition-all duration-200"
            title="Upgrade to v2" [disabled]="!buttonStates?.upgradeEnabled"
            [class.disabled]="!buttonStates?.upgradeEnabled" (click)="onUpgradeToVersion('v2')">
            <span class="text-xs font-medium">v2</span>
          </button>
          <button class="player-btn upgrade-btn px-3 py-2 rounded hover:bg-opacity-75 transition-all duration-200"
            title="Upgrade to v3" [disabled]="!buttonStates?.upgradeEnabled"
            [class.disabled]="!buttonStates?.upgradeEnabled" (click)="onUpgradeToVersion('v3')">
            <span class="text-xs font-medium">v3</span>
          </button>
        </div>
      </div>


      <!-- Version History Toggle -->
      <div class="history-toggle">
        <button class="w-full text-left p-2 rounded text-xs hover:bg-opacity-75 transition-all duration-200"
          style="background: rgba(0, 255, 255, 0.1); border: 1px solid rgba(0, 255, 255, 0.3); color: var(--accent-cyan);"
          (click)="onToggleHistory()">
          ðŸ“Š Version History
          <span class="float-right">{{ showHistoryTable() ? 'â–¼' : 'â–¶' }}</span>
        </button>

        @if (showHistoryTable()) {
        <div class="mt-2 history-table">
          @if (rolloutHistory.length > 0) {
          <div class="overflow-x-auto">
            <table class="w-full text-xs">
              <thead>
                <tr class="border-b" style="border-color: rgba(0, 255, 255, 0.3);">
                  <th class="text-left p-1 font-medium" style="color: var(--accent-cyan);">Rev</th>
                  <th class="text-left p-1 font-medium" style="color: var(--accent-cyan);">Image</th>
                  <!-- <th class="text-left p-1 font-medium" style="color: var(--accent-cyan);">Change Cause</th> -->
                  <th class="text-left p-1 font-medium" style="color: var(--accent-cyan);">Created</th>
                </tr>
              </thead>
              <tbody>
                @for (item of rolloutHistory; track item.revision) {
                <tr class="border-b group" style="border-color: rgba(0, 255, 255, 0.1);">
                  <td class="p-1" style="color: var(--text-primary);">{{ item.revision }}</td>
                  <td class="p-1 font-mono text-xs relative" style="color: var(--text-primary);">
                    <div class="flex items-center justify-between">
                      <span class="truncate" style="max-width: 150px;" [title]="item.image">{{ item.image }}</span>
                      <button
                        class="copy-btn opacity-0 group-hover:opacity-100 transition-all duration-200 p-1 rounded text-xs ml-1 flex-shrink-0"
                        (click)="onCopyToClipboard(item.image, $event)" [attr.data-copy-tooltip]="'Copy ' + item.image">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                          stroke-width="2">
                          <rect width="14" height="14" x="8" y="8" rx="2" ry="2" />
                          <path d="m4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2" />
                        </svg>
                      </button>
                    </div>
                  </td>
                  <!-- <td class="p-1" style="color: var(--text-primary);">{{ item.changeCause }}</td> -->
                  <td class="p-1" style="color: var(--text-secondary);">{{ item.created }}</td>
                </tr>
                }
              </tbody>
            </table>
          </div>
          } @else {
          <div class="text-xs text-center py-2 italic" style="color: var(--text-secondary);">
            No rollout history available
          </div>
          }
        </div>
        }
      </div>

    </div>
  </div>
</div>
}