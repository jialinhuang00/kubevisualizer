<div class="min-h-screen p-3">
  <div class="max-w-7xl mx-auto">
    <header class="mb-4">
      <h1 class="text-2xl font-bold glow-text mb-1" style="color: var(--accent-cyan)">{{ title() }}</h1>
      <p class="text-xs" style="color: var(--text-secondary)">Kubectl Commands Visualized</p>
    </header>

    <div class="grid grid-cols-[350px_1fr] gap-4">
      <!-- Sidebar: Commands -->
      <div class="cyber-container p-3">
        <h2 class="text-lg font-semibold mb-3 glow-text" style="color: var(--text-primary)">Commands</h2>

        <!-- Namespace Selector -->
        <div class="mb-4">
          <label class="block text-sm font-medium mb-2" style="color: var(--text-primary)">
            Target Namespace
          </label>
          <div class="relative">
            <select class="w-full p-3 text-sm font-medium cyber-button appearance-none cursor-pointer"
              style="background: rgba(255, 255, 255, 0.08); border: 1px solid rgba(255, 255, 255, 0.2);"
              [value]="selectedNamespace()" (change)="onNamespaceChange($event)">
              @for (ns of namespaces(); track ns) {
              <option [value]="ns">{{ ns }}</option>
              }
            </select>
            <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
              <svg class="w-4 h-4" style="color: var(--text-secondary)" fill="none" stroke="currentColor"
                viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </div>
          </div>
        </div>

        <!-- General Templates -->
        <div class="mb-4">
          <div class="flex items-center justify-between mb-2 cursor-pointer p-2 rounded"
            style="background: rgba(255, 255, 255, 0.05);" (click)="toggleGeneralSection()">
            <h3 class="text-sm font-medium" style="color: var(--text-primary)">General Commands</h3>
            <span class="text-sm transition-transform duration-200" style="color: var(--text-secondary);"
              [style.transform]="isGeneralExpanded() ? 'rotate(90deg)' : 'rotate(0deg)'">
              ▶
            </span>
          </div>
          @if (isGeneralExpanded()) {
          <div class="space-y-1">
            @for (template of generalTemplates(); track template.id) {
            <div class="p-2 cursor-pointer hover:bg-opacity-30 transition-colors border border-gray-600 rounded"
              style="background: rgba(255, 255, 255, 0.03); border-color: rgba(255, 255, 255, 0.08);"
              (click)="executeTemplate(template)">
              <div class="text-xs font-medium mb-1" style="color: var(--text-primary);">
                {{ template.name }}
              </div>
              <div class="text-xs opacity-75 truncate" style="color: var(--text-secondary); line-height: 1.2;"
                [title]="template.command">
                {{ template.command }}
              </div>
            </div>
            }
          </div>
          }
        </div>

        <!-- Deployment Specific Templates -->
        @if (deploymentTemplates().length > 0) {
        <div class="mb-4">
          <div class="flex items-center justify-between mb-2 cursor-pointer p-2 rounded"
            style="background: rgba(255, 255, 255, 0.05);" (click)="toggleDeploymentSection()">
            <h3 class="text-sm font-medium" style="color: var(--text-primary)">Deployment Commands</h3>
            <span class="text-sm transition-transform duration-200" style="color: var(--text-secondary);"
              [style.transform]="isDeploymentExpanded() ? 'rotate(90deg)' : 'rotate(0deg)'">
              ▶
            </span>
          </div>
          @if (isDeploymentExpanded()) {
          <div class="space-y-1">
            @for (template of deploymentTemplates(); track template.id) {
            <div class="p-2 cursor-pointer hover:bg-opacity-30 transition-colors border border-gray-600 rounded"
              style="background: rgba(255, 255, 255, 0.03); border-color: rgba(255, 255, 255, 0.08);"
              (click)="executeTemplate(template)">
              <div class="text-xs font-medium mb-1" style="color: var(--text-primary);">
                {{ template.name }}
              </div>
              <div class="text-xs opacity-75 truncate" style="color: var(--text-secondary); line-height: 1.2;"
                [title]="template.command">
                {{ template.command }}
              </div>
            </div>
            }
          </div>
          }
        </div>
        }

        <!-- Pod Specific Templates -->
        @if (podTemplates().length > 0) {
        <div class="mb-4">
          <div class="flex items-center justify-between mb-2 cursor-pointer p-2 rounded"
            style="background: rgba(255, 255, 255, 0.05);" (click)="togglePodSection()">
            <h3 class="text-sm font-medium" style="color: var(--text-primary)">Pod Commands</h3>
            <span class="text-sm transition-transform duration-200" style="color: var(--text-secondary);"
              [style.transform]="isPodSectionExpanded() ? 'rotate(90deg)' : 'rotate(0deg)'">
              ▶
            </span>
          </div>
          @if (isPodSectionExpanded()) {
          <div class="space-y-1">
            @for (template of podTemplates(); track template.id) {
            <div class="p-2 cursor-pointer hover:bg-opacity-30 transition-colors border border-gray-600 rounded"
              style="background: rgba(255, 255, 255, 0.03); border-color: rgba(255, 255, 255, 0.08);"
              (click)="executeTemplate(template)">
              <div class="text-xs font-medium mb-1" style="color: var(--text-primary);">
                {{ template.name }}
              </div>
              <div class="text-xs opacity-75 truncate" style="color: var(--text-secondary); line-height: 1.2;"
                [title]="template.command">
                {{ template.command }}
              </div>
            </div>
            }
          </div>
          }
        </div>
        }
      </div>

      <!-- Main Content Area -->
      <div class="space-y-3 overflow-x-auto">
        <!-- Custom Command Input -->
        <div class="cyber-container p-3">
          <h2 class="text-lg font-semibold mb-2 glow-text" style="color: var(--accent-cyan)">Command Interface</h2>
          <div class="grid grid-cols-1 gap-2">
            <div>
              <label class="block text-xs font-medium mb-1" style="color: var(--text-secondary)">
                Kubectl Command
              </label>
              <input type="text" class="w-full p-2 bg-black border border-subtle font-mono text-xs terminal-output"
                style="color: var(--accent-green); border-color: var(--border-subtle);"
                placeholder="kubectl get pods -n noah" [value]="customCommand()"
                (input)="onCustomCommandChange($event)">
            </div>
            <div class="flex gap-2">
              <button class="flex-1 cyber-button py-2 px-3 font-semibold text-xs" [disabled]="isLoading()"
                (click)="executeCustomCommand()">
                {{ isLoading() ? 'EXECUTING...' : 'EXECUTE' }}
              </button>
              <div class="text-xs" style="color: var(--text-secondary); line-height: 2.5;">
                Supports: Tables • YAML • JSON • custom-columns • --no-headers
              </div>
            </div>
          </div>
        </div>

        <!-- Command Output & Visualization -->
        <div>
          <div class="cyber-container p-3">
            <h2 class="text-lg font-semibold mb-2 glow-text" style="color: var(--accent-cyan)">Output Display</h2>

            @if (commandOutput() && !results().length) {
            <!-- Raw Output (JSON, YAML, text, etc.) -->
            <div class="terminal-output p-2 overflow-x-auto text-xs">
              <pre>{{ commandOutput() }}</pre>
            </div>
            } @else if (podDescribeData().length > 0) {
            <!-- Multiple Pod Describe Output -->
            <div class="space-y-4">
              @for (pod of podDescribeData(); track pod.name) {
              <div class="cyber-container p-3">
                <h3 class="text-sm font-medium mb-2 glow-text" style="color: var(--accent-cyan)">Pod: {{ pod.name }}
                </h3>

                <!-- Resource Details Accordion -->
                <div class="mb-3">
                  <div class="flex items-center justify-between mb-1 cursor-pointer cyber-button p-2"
                    (click)="togglePodDetails(pod.name)">
                    <h4 class="text-xs font-medium glow-text" style="color: var(--accent-purple)">Resource Details</h4>
                    <span class="text-sm transition-transform duration-200" style="color: var(--accent-cyan);"
                      [style.transform]="isPodExpanded(pod.name) ? 'rotate(90deg)' : 'rotate(0deg)'">
                      ▶
                    </span>
                  </div>
                  @if (isPodExpanded(pod.name)) {
                  <div class="terminal-output p-2 overflow-x-auto text-xs">
                    <pre>{{ pod.details }}</pre>
                  </div>
                  }
                </div>

                <!-- Events Table -->
                @if (pod.events.length > 0) {
                <div>
                  <h4 class="text-xs font-medium mb-1 glow-text" style="color: var(--accent-purple)">Events</h4>
                  <div class="overflow-x-auto">
                    <table class="min-w-full compact-table">
                      <thead style="background: var(--bg-tertiary);">
                        <tr>
                          @for (header of pod.headers; track header) {
                          <th class="text-left glow-text compact-spacing"
                            style="color: var(--accent-purple); border-bottom: 1px solid var(--border-subtle);">
                            {{ header }}
                          </th>
                          }
                        </tr>
                      </thead>
                      <tbody style="background: rgba(0, 0, 0, 0.3);">
                        @for (event of pod.events; track $index) {
                        <tr style="border-bottom: 1px solid var(--border-subtle);" class="hover:bg-opacity-50">
                          @for (header of pod.headers; track header) {
                          <td class="compact-spacing">
                            @if (header.toLowerCase() === 'type') {
                            <span class="inline-flex px-1 py-0.5 text-xs font-medium rounded-sm" [style]="event[header.toLowerCase()] === 'Normal' ? 'color: var(--accent-green); background: rgba(57, 255, 20, 0.1)' : 
                                         'color: var(--text-secondary); background: rgba(255, 255, 255, 0.05)'">
                              {{ event[header.toLowerCase()] || '-' }}
                            </span>
                            } @else if (header.toLowerCase() === 'message') {
                            <span class="text-ellipsis" [title]="event[header.toLowerCase()] || '-'"
                              style="color: var(--text-secondary); max-width: 300px;">
                              {{ event[header.toLowerCase()] || '-' }}
                            </span>
                            } @else {
                            <span style="color: var(--text-secondary)">
                              {{ event[header.toLowerCase()] || '-' }}
                            </span>
                            }
                          </td>
                          }
                        </tr>
                        }
                      </tbody>
                    </table>
                  </div>
                </div>
                }
              </div>
              }
            </div>
            } @else if (commandOutput() && results().length > 0 && hasEventsTable()) {
            <!-- Single Pod Mixed Output: YAML/text + Events Table -->
            <div class="space-y-3">
              <div>
                <div class="flex items-center justify-between mb-1 cursor-pointer cyber-button p-2"
                  (click)="toggleResourceDetails()">
                  <h3 class="text-sm font-medium glow-text" style="color: var(--accent-purple)">Resource Details</h3>
                  <span class="text-sm transition-transform duration-200" style="color: var(--accent-cyan);"
                    [style.transform]="isResourceDetailsExpanded() ? 'rotate(90deg)' : 'rotate(0deg)'">
                    ▶
                  </span>
                </div>
                @if (isResourceDetailsExpanded()) {
                <div class="terminal-output p-2 overflow-x-auto text-xs">
                  <pre>{{ commandOutput() }}</pre>
                </div>
                }
              </div>
              <div>
                <h3 class="text-sm font-medium mb-1 glow-text" style="color: var(--accent-purple)">Events</h3>
                <div class="overflow-x-auto">
                  <table class="min-w-full compact-table">
                    <thead style="background: var(--bg-tertiary);">
                      <tr>
                        @for (header of headers(); track header) {
                        <th class="text-left glow-text compact-spacing"
                          style="color: var(--accent-purple); border-bottom: 1px solid var(--border-subtle);">
                          {{ header }}
                        </th>
                        }
                      </tr>
                    </thead>
                    <tbody style="background: rgba(0, 0, 0, 0.3);">
                      @for (item of results(); track $index) {
                      <tr style="border-bottom: 1px solid var(--border-subtle);" class="hover:bg-opacity-50">
                        @for (header of headers(); track header) {
                        <td class="compact-spacing">
                          @if (header.toLowerCase() === 'type') {
                          <span class="inline-flex px-1 py-0.5 text-xs font-medium rounded-sm" [style]="item[header.toLowerCase()] === 'Normal' ? 'color: var(--accent-green); background: rgba(57, 255, 20, 0.1)' : 
                                       'color: var(--text-secondary); background: rgba(255, 255, 255, 0.05)'">
                            {{ item[header.toLowerCase()] || '-' }}
                          </span>
                          } @else if (header.toLowerCase() === 'message') {
                          <span class="text-ellipsis" [title]="item[header.toLowerCase()] || '-'"
                            style="color: var(--text-secondary); max-width: 300px;">
                            {{ item[header.toLowerCase()] || '-' }}
                          </span>
                          } @else {
                          <span style="color: var(--text-secondary)">
                            {{ item[header.toLowerCase()] || '-' }}
                          </span>
                          }
                        </td>
                        }
                      </tr>
                      }
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
            } @else if (results().length > 0) {
            <!-- Tabular Output -->
            <div class="overflow-x-auto">
              <table class="min-w-full compact-table">
                <thead style="background: var(--bg-tertiary);">
                  <tr>
                    @for (header of headers(); track header) {
                    <th class="text-left glow-text compact-spacing"
                      style="color: var(--accent-purple); border-bottom: 1px solid var(--border-subtle);">
                      {{ header }}
                    </th>
                    }
                  </tr>
                </thead>
                <tbody style="background: rgba(0, 0, 0, 0.3);">
                  @if (isLoading()) {
                  <tr>
                    <td [attr.colspan]="headers().length" class="text-center compact-spacing"
                      style="color: var(--text-secondary);">
                      EXECUTING...
                    </td>
                  </tr>
                  } @else {
                  @for (item of results(); track $index) {
                  <tr style="border-bottom: 1px solid var(--border-subtle);" class="hover:bg-opacity-50">
                    @for (header of headers(); track header) {
                    <td class="compact-spacing">
                      @if (header.toLowerCase() === 'status') {
                      <span class="inline-flex px-1 py-0.5 text-xs font-medium rounded-sm"
                        [class]="item[header.toLowerCase()] === 'Running' ? 'neon-border' : 'border border-subtle'"
                        [style]="item[header.toLowerCase()] === 'Running' ? 'color: var(--accent-green); background: rgba(57, 255, 20, 0.1)' : 
                                   item[header.toLowerCase()] === 'Pending' ? 'color: var(--accent-purple); background: rgba(157, 78, 221, 0.1)' :
                                   'color: var(--text-secondary); background: rgba(255, 255, 255, 0.05)'">
                        {{ item[header.toLowerCase()] || '-' }}
                      </span>
                      } @else if (header.toLowerCase().includes('image') || header.toLowerCase().includes('name')) {
                      <span class="text-ellipsis" [title]="item[header.toLowerCase()] || '-'"
                        [style]="header.toLowerCase().includes('name') ? 'color: var(--text-primary); font-weight: 500;' : 'color: var(--text-secondary)'">
                        {{ item[header.toLowerCase()] || '-' }}
                      </span>
                      } @else {
                      <span [style]="'color: var(--text-secondary)'">
                        {{ item[header.toLowerCase()] || '-' }}
                      </span>
                      }
                    </td>
                    }
                  </tr>
                  }
                  }
                </tbody>
              </table>
            </div>
            } @else if (!isLoading()) {
            <div class="text-center text-gray-500 py-8">
              <svg class="mx-auto h-12 w-12 text-gray-400 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z" />
              </svg>
              <h3 class="text-lg font-medium text-gray-900 mb-2">Ready to Execute</h3>
              <p class="text-gray-500">Enter a kubectl command and click "Execute & Visualize" to see beautiful results
              </p>
            </div>
            } @else {
            <div class="text-center text-gray-500 py-8">
              <div
                class="animate-spin inline-block w-8 h-8 border-[3px] border-current border-t-transparent text-blue-600 rounded-full mb-4">
              </div>
              <div class="text-lg font-medium">Executing command...</div>
              <div class="text-sm">{{ customCommand() }}</div>
            </div>
            }
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<router-outlet />